<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Thingus Perfectus by DataDynamics.Labs</title>

    <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">
		<link href="bootstrap/css/bootstrap-theme.min.css" rel="stylesheet" />
		<link href="noUiSlider/nouislider.min.css" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css?family=Hind|Lato:400,700,900" rel="stylesheet">
		<style>
		/*
		Overskrifter (H1, H2): Lato Black eller Lato 900.
		CSS: Letter-spacing: 1px; text-transform: uppercase;

		Overskrifter (H3-H4): Lato Bold eller Lato 700.
		CSS: Letter-spacing: 1px; text-transform: uppercase;

		Overskrifter (H5-H6): Hind (alternativt Roboto Regular)

		Brødtekst: Hind (alternativt Roboto Regular)


		font-family: 'Lato', sans-serif;
		font-family: 'Hind', sans-serif;

		Blå: #5cb2e4
		Grønn lys: #8dc63f
		Grønn mørk: #009444
		Grå: #dddede

		*/

		body{
			background-color: #dddede;
			font-family: 'Hind', sans-serif;
		}

	  .chart rect {
	    fill: #8dc63f;
	  }

    .chart .salary_bar {
      fill: #000000;
    }

	  .chart text {
	    fill: #009444;
			font-size: 0.8em;
	  }

	  .axis path,
	  .axis line {
	    fill: none;
	    stroke: #000;
	    shape-rendering: crispEdges;
	  }

    .svg-container {
        display: inline-block;
        position: relative;
        width: 100%;
        padding-bottom: 100%; /* aspect ratio */
        vertical-align: top;
        overflow: hidden;
    }

	  </style>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <div class="row">
        <div class="col-lg-12">

          <h2><small><a href="https://stianovrevage.github.io/">DataDynamics.Labs</a></small> Thingus Perfectus</h2>

          <div class="alert alert-danger alert-dismissible text-center" role="alert">
            <button type="button" class="close" data-dismiss="alert"><span>&times;</span></button>
            <strong>Dette er en tidlig utviklingsversjon av 123statsbudsjett
              og utseende og funksjonalitet har derfor varierende kvalitet.</strong>
          </div>

          <div class="example">
            <div id="salary" class="text-center"></div>
            <div id="salary_slider"></div><br><br><br>

            <div id="your_part_of_norway_income_div" class="text-center"></div><br>

          </div>

        </div>
      </div>

      <div class="row">
        <div class="col-lg-12">

          <div>

            <!-- Nav tabs -->
            <ul class="nav nav-pills nav-justified" role="tablist">
              <li role="presentation" class="active"><a href="#quiz" role="tab" data-toggle="tab">Quiz</a></li>
              <li role="presentation"><a href="#skatt" role="tab" data-toggle="tab">Din skatt</a></li>
              <li role="presentation"><a href="#staten" role="tab" data-toggle="tab">Statens inntekter og utgifter</a></li>
              <li role="presentation"><a href="#fylke" role="tab" data-toggle="tab">Fylkets inntekter og utgifter</a></li>
              <li role="presentation"><a href="#kommune" role="tab" data-toggle="tab">Kommunens inntekter og utgifter</a></li>
              <li role="presentation"><a href="#about" role="tab" data-toggle="tab">Om thingus perfectus</a></li>
            </ul>
            <br>
            <!-- Tab panes -->
            <div class="tab-content">

              <div role="tabpanel" class="tab-pane active" id="quiz">
                <div class="well well-lg">
                  Quiz:<br>


                    <div id="q1" class="text-center">
                      1. Hvor stort er det norske statsbudjsettet?

                      Info: Hva er statsbudsjettet

                      100 millioner til 10000 milliarder

                      <div id="quiz_q1_value_field" class="text-center"></div>
                      <div id="quiz_q1_slider"></div><br><br><br>
                      <div id="quiz_q1_answer_field"></div>
                      <button class="btn" onClick="check_answer(quiz_q1_value, 1611494577000, 'quiz_q1_answer_field');">Neste</button>
                    </div>

                    <div id="q2" class="text-center">
                        2. Hvor stor del av statusbudsjettet dekker vi inn via det såkalte oljefondet?

                        Info om oljefondet (korrigert underskudd osv)

                        <div id="quiz_q2_value_field" class="text-center"></div>
                        <div id="quiz_q2_slider"></div><br><br><br>
                        <div id="quiz_q2_answer_field"></div>
                        <button class="btn" onClick="check_answer(quiz_q2_value, 259506128000, 'quiz_q2_answer_field');">Neste</button>
                    </div>

                    <div  id="q3" class="text-center">
                        3. Hvor mye av statens inntekter er skatt på inntekt, formue, arbeidsgiveravgift og trygdeavgift?

                        0-100%

                        <div id="quiz_q3_value_field" class="text-center"></div>
                        <div id="quiz_q3_slider"></div><br><br><br>
                        <div id="quiz_q3_answer_field"></div>
                        <button class="btn" onClick="check_answer(quiz_q3_value, 35.2, 'quiz_q3_answer_field');">Check</button>
                    </div>

                    <div  id="q4" class="text-center">
                        4. Hvor stor andel går til alderspensjoner?

                        <div id="quiz_q4_value_field" class="text-center"></div>
                        <div id="quiz_q4_slider"></div><br><br><br>
                        <div id="quiz_q4_answer_field"></div>
                        <button class="btn" onClick="check_answer(quiz_q4_value, 35.2, 'quiz_q4_answer_field');">Check</button>
                    </div>

                    <div  id="q5" class="text-center">
                        5. Hvor stor andel går til trygd?

                        <div id="quiz_q5_value_field" class="text-center"></div>
                        <div id="quiz_q5_slider"></div><br><br><br>
                        <div id="quiz_q5_answer_field"></div>
                        <button class="btn" onClick="check_answer(quiz_q5_value, 35.2, 'quiz_q5_answer_field');">Check</button>
                    </div>

                    <div  id="q6" class="text-center">
                        6. Hvor mye bruker vi på bistand?

                        <div id="quiz_q6_value_field" class="text-center"></div>
                        <div id="quiz_q6_slider"></div><br><br><br>
                        <div id="quiz_q6_answer_field"></div>
                        <button class="btn" onClick="check_answer(quiz_q6_value, 35.2, 'quiz_q6_answer_field');">Check</button>
                    </div>

                    <div  id="q7" class="text-center">
                        7. Klima?

                        <div id="quiz_q7_value_field" class="text-center"></div>
                        <div id="quiz_q7_slider"></div><br><br><br>
                        <div id="quiz_q7_answer_field"></div>
                        <button class="btn" onClick="check_answer(quiz_q7_value, 35.2, 'quiz_q7_answer_field');">Check</button>
                    </div>

                    <div  id="q8" class="text-center">
                        8. Politi og forsvar?

                        <div id="quiz_q8_value_field" class="text-center"></div>
                        <div id="quiz_q8_slider"></div><br><br><br>
                        <div id="quiz_q8_answer_field"></div>
                        <button class="btn" onClick="check_answer(quiz_q8_value, 35.2, 'quiz_q8_answer_field');">Check</button>
                    </div>

                    <div  id="q9" class="text-center">
                        9. ???

                        <div id="quiz_q9_value_field" class="text-center"></div>
                        <div id="quiz_q9_slider"></div><br><br><br>
                        <div id="quiz_q9_answer_field"></div>
                        <button class="btn" onClick="check_answer(quiz_q9_value, 35.2, 'quiz_q9_answer_field');">Check</button>
                    </div>

                </div>
              </div>


              <div role="tabpanel" class="tab-pane" id="skatt">
                <div class="well well-lg">

                  <svg id="total_tax" class="chart"></svg><br>
                  <svg id="tax_details" class="chart"></svg><br>

                </div>
              </div>
              <div role="tabpanel" class="tab-pane" id="staten">

                <div class="well well-lg">
                  Statens utgifter per måned:<br>
                  <svg id="norway_expenses" class="chart"></svg><br>
                </div>

                <div class="well well-lg">
                  Statens inntekter:<br>
                  <svg id="norway_income" class="chart"></svg><br>
                </div>

              </div>

              <div role="tabpanel" class="tab-pane" id="fylke">
                <div class="well well-lg">
                  Fylkets utgifter:<br>
                  <svg id="county_expenses" class="chart"></svg><br>
                </div>
              </div>

              <div role="tabpanel" class="tab-pane" id="kommune">
                <div class="well well-lg">
                  Kommunens utgifter:<br>
                  <svg id="municipality_expenses" class="chart"></svg><br>
                </div>
              </div>

              <div role="tabpanel" class="tab-pane" id="about">
                <div class="well well-lg">

                  <div class="text-center">
                    Hvem er vi? Hvorfor dette?

                    Bakgrunn for prosjektet
                    De siste ti årene har vi vært vitne til økende polarisering av politikk og samfunn både i Norge og internasjonalt.
                    Det har ført til blant annet tidligere utenkelige utfall i valg av president i USA samt valget om hvorvidt Storbritania
                    skal forlate EU. Og mye tyder på at trenden vil fortsette med forestående valg i blant annet Italia.

                    Hva er årsaken? Media må ta sin del av ansvaret. De har, som kapitalismen antageligvis kunne forutse, høyere fokus
                    på profitt enn sin oppgave som tredje statsmakt og legge grunnlaget for en opplyst befolkning som er en forutsetning
                    for et velfungerende demokrati. Dessverre er det mer lønnsomt med sensasjonalistiske oppslag på stadig tynnere faktagrunnlag.

                    Facebook har også gitt grobunn for en ny industri med utelukkende fabrikerte nyheter basert på oppdiktede fakta. Dessverre
                    har det menneskelige sinn en lei tendens til å akseptere påstander som støtter det vi allerede tror på, uavhengig av om
                    det er sant eller ikke. Kombinert med såkalte filter-bubbles som Facebook og Google bygger rundt oss kan vi være en del av
                    debatten men kun se sin egen side av saken og slippe ubehaget ved å se motstridende argumenter.

                    Målet med dette verktøyet er å de-polarisere den politiske debatten ved å vise hvor like forskjellige politiske partier er
                    når det kommer til budsjettprioriteringer og å bryte ned astronomiske summer i statsbudsjetter til håndterlige summer basert
                    på hva den enkelte betaler i skatt. Det er også mulig å sammenligne f.eks. skattenivået i Norge med våre naboland for å vise
                    at likhetene er større en forskjellene.

                    De aller fleste av oss ønsker det samme resultatet, et trygt og godt samfunn, men en polarisering og demonisering av "de andre"
                    er ikke måten å gjøre det på.

                    </article>

                    </details>

                  </div>

                  <h3>Kilder</h3>
                  <ul>
                    <li><a href="http://www.statsbudsjettet.no/upload/Statsbudsjett_2017/dokumenter/pdf/gulbok.pdf"> Forslag statsbudsjett 2017 - Gul bok</a></li>
                    <li><a href="http://www.statsbudsjettet.no/Statsbudsjettet-2017/Dokumenter1/Budsjettdokumenter/Statsbudsjettet-2017/Prop-1-S/Vedlegg-og-registre/Vedlegg-1-Oversikt-over-utgifter-og-inntekter-i-statsbudsjettet-for-budsjetterminen-2017/">Oversikt-over-utgifter-og-inntekter-i-statsbudsjettet-for-budsjetterminen-2017</a></li>
                  </ul>
                  <hr>
                  <div class="text-center">
                    <img height="50px" src="dd-logo-transparent.png" alt="Made with love by DataDynamics" class="img-rounded">
                  </div>

                </div>
              </div>
            </div>
      		</div>
          <div class="text-center">
          Made with <span class="glyphicon glyphicon-heart" style="color: red;"></span> by <a href="https://stianovrevage.github.io">DataDynamics.Labs</a>
          </div>
        </div>
      </div>
    </div>



		<script src="noUiSlider/nouislider.min.js" type="text/javascript"></script>
		<script src="wNumb.js" type="text/javascript"></script>

		<script src="bootstrap/js/jquery.min.js" type="text/javascript"></script>
		<script src="bootstrap/js/bootstrap.min.js" type="text/javascript"></script>

	  <script src="d3.v4.min.js"></script>
	  <script src="bullet.js"></script>
	  <script src="mittbudsjett.js"></script>

  </body>

	<script>

	var moneyFormat = wNumb({
		mark: ',',
    decimals: '0',
		thousand: ' ',
		prefix: '',
		postfix: ' kr'
	});

  var small_ppm_format = wNumb({
		mark: ',',
		decimals: '7',
		thousand: ' ',
		prefix: '',
		postfix: ' ‰'
	});

  var pct_format = wNumb({
    mark: ',',
    decimals: '0',
    thousand: ' ',
    prefix: '',
    postfix: ' %'
  });


	function trygdeavgift(personinntekt){
	    var nedre_grense_trygdeavgift = 54650,
	        opptrappingssats = 0.25,
	        sats = 0.082;

	    if(personinntekt < nedre_grense_trygdeavgift){
	        return 0;
	    }

	    var full_rate = personinntekt * sats;
	    var reduced_rate = (personinntekt - nedre_grense_trygdeavgift) * opptrappingssats;

	    if(reduced_rate < full_rate){
	        return Number(reduced_rate.toFixed(0));
	    }else{
	        return Number(full_rate.toFixed(0));
	    }
	}

	function personskatt_stat(alminnelig_inntekt){
	    var sats = 9.55 / 100;
	    var skatt = alminnelig_inntekt * sats;
	    return Number(skatt.toFixed(0));
	}

	function personskatt_fylke(alminnelig_inntekt){
	    var sats = 2.65 / 100;
	    var skatt = alminnelig_inntekt * sats;
	    return Number(skatt.toFixed(0));
	}

	function personskatt_kommune(alminnelig_inntekt){
	    var sats = 11.80 / 100;
	    var skatt = alminnelig_inntekt * sats;
	    return Number(skatt.toFixed(0));
	}

	function personskatt_trinn1(alminnelig_inntekt){
	    var trinnskatt1_innslag = 164100;
	    var trinnskatt1_sats = 0.93 / 100;

	    if(alminnelig_inntekt > trinnskatt1_innslag){
					var trinnskatt1 = (alminnelig_inntekt - trinnskatt1_innslag) * trinnskatt1_sats;
	        return Number(trinnskatt1.toFixed(0));
	    }else{
	        return 0;
	    }
	}

	function personskatt_trinn2(alminnelig_inntekt){
	    var trinnskatt2_innslag = 230950;
	    var trinnskatt2_sats = 2.41 / 100;

	    if(alminnelig_inntekt > trinnskatt2_innslag){
					var trinnskatt2 = (alminnelig_inntekt - trinnskatt2_innslag) * trinnskatt2_sats;
	        return Number(trinnskatt2.toFixed(0));
	    }else{
	        return 0;
	    }
	}

	function personskatt_trinn3(alminnelig_inntekt){
	    var trinnskatt3_innslag = 580650;
	    var trinnskatt3_sats = 11.52 / 100;

	    if(alminnelig_inntekt > trinnskatt3_innslag){
					var trinnskatt3 = (alminnelig_inntekt - trinnskatt3_innslag) * trinnskatt3_sats;
	        return Number(trinnskatt3.toFixed(0));
	    }else{
	        return 0;
	    }
	}

	function personskatt_trinn4(alminnelig_inntekt){
	    var trinnskatt4_innslag = 934050;
	    var trinnskatt4_sats = 14.52 / 100;

	    if(alminnelig_inntekt > trinnskatt4_innslag){
					var trinnskatt4 = (alminnelig_inntekt - trinnskatt4_innslag) * trinnskatt4_sats;
	        return Number(trinnskatt4.toFixed(0));
	    }else{
	        return 0;
	    }
	}

	function total_skatt(personinntekt, alminnelig_inntekt){
			var total_skatt = 0;
			total_skatt += trygdeavgift(personinntekt);
			total_skatt += personskatt_stat(alminnelig_inntekt);
			total_skatt += personskatt_fylke(alminnelig_inntekt);
			total_skatt += personskatt_kommune(alminnelig_inntekt);
			total_skatt += personskatt_trinn1(alminnelig_inntekt);
			total_skatt += personskatt_trinn2(alminnelig_inntekt);
			total_skatt += personskatt_trinn3(alminnelig_inntekt);
			total_skatt += personskatt_trinn4(alminnelig_inntekt);
			return total_skatt;
	}

	function total_skatt_pct(personinntekt, alminnelig_inntekt){
			var total_skatt_pct = ( total_skatt(personinntekt, alminnelig_inntekt) / personinntekt ) * 100;
			return Number(total_skatt_pct.toFixed(2));
	}

	var total_tax_data = [{ id: "total_skatt",
								name: "Total skatt",
								amount: 0}]

	var tax_detail_data = [{ id: "trygdeavgift",
	              name: "Trygdeavgift",
	              amount: 0},
	            { id: "personskatt_stat",
	              name: "Personskatt til Staten",
	              amount: 0},
							{ id: "personskatt_fylke",
								name: "Personskatt til Fylkeskommunen",
								amount: 0},
							{ id: "personskatt_kommune",
								name: "Personskatt til Kommunen",
								amount: 0},
	            { id: "personskatt_trinn1",
	              name: "Trinnskatt 1",
	              amount: 0},
	            { id: "personskatt_trinn2",
	              name: "Trinnskatt 2",
	              amount: 0},
	            { id: "personskatt_trinn3",
	              name: "Trinnskatt 3",
	              amount: 0},
	            { id: "personskatt_trinn4",
	              name: "Trinnskatt 4",
	              amount: 0}
	            ];

	var barHeight = 15;

	// Define canvas size
	var margin = {top: 20, right: 30, bottom: 30, left: 40},
	    width = 960 - margin.left - margin.right,
	    height = 300 - margin.top - margin.bottom;

	var total_tax_bar_height = 30;

	// Establish the horizontal scale
	var x_salary_scale = d3.scaleLinear()
	    .domain([0, 100000])
	    .range([0, width]);

	var xAxis = d3.axisBottom()
	    .scale(x_salary_scale);

	// Total tax bar
	var total_tax = d3.select("#total_tax")
	    .attr("width", width)
	    .attr("height", total_tax_bar_height);

	var total_tax_bar = total_tax.selectAll("g")
	    .data(total_tax_data)
	  .enter().append("g")
	    .attr("transform", function(d, i) { return "translate(0," + i * barHeight + ")"; });

	total_tax_bar.append("rect")
	    .attr("id", "bar_salary")
      .classed("salary_bar", true)
	    .attr("width",  width )
	    .attr("height", barHeight - 1);

  total_tax_bar.append("rect")
	    .attr("id", function(d) { return "bar_"+d.id; } )
	    .attr("width", function(d) { return x_salary_scale(d.amount); } )
	    .attr("height", barHeight - 1);

	total_tax_bar.append("text")
	    .attr("id", function(d) { return "label_"+d.id; } )
	    .attr("x", "120" )
	    .attr("y", barHeight / 2)
	    .attr("dy", ".35em")
	    .text(function(d) { return d.name; });


  var global_norsk_statsbudsjett_2017_inntekter;
  var global_norsk_statsbudsjett_2017_utgifter;
  var global_norway_total_income = 0; // Init this var as number.
  var global_norway_total_expenses = 0; // Init this var as number.

  var global_norway_expenses_bars;

  d3.queue()
    .defer(d3.json, 'norsk_statsbudsjett_2017_inntekter.json')
    .defer(d3.json, 'norsk_statsbudsjett_2017_utgifter.json')
    .await(function(error, norsk_statsbudsjett_2017_inntekter, norsk_statsbudsjett_2017_utgifter) {

      global_norsk_statsbudsjett_2017_inntekter = norsk_statsbudsjett_2017_inntekter;
      global_norsk_statsbudsjett_2017_utgifter = norsk_statsbudsjett_2017_utgifter;

      // Norway income chart
      var personinntekt = 528000;

      var norway_income_chart = d3.select("#norway_income")
			    //.attr("width", width)
			    //.attr("height", barHeight * norsk_statsbudsjett_2017_inntekter.length)
          .classed("svg-container", true)
          .attr("preserveAspectRatio", "xMinYMin meet")
          .attr("viewBox", "0 0 600 400");

			var norway_income_bars = norway_income_chart.selectAll("g")
			    .data(norsk_statsbudsjett_2017_inntekter.sort(function(a,b) { return b.amount - a.amount; }), function(d){ global_norway_total_income += d.amount; })
			  .enter().append("g")
			    .attr("transform", function(d, i) { return "translate(0," + i * barHeight + ")"; });

			var x_budget_scale = d3.scaleLinear()
					.domain([0, global_norway_total_income])
					.range([0, width]);

			norway_income_bars.append("rect")
			    .attr("id", function(d) { return "bar_"+d.id; } )
			    .attr("width", function(d) { return x_budget_scale(d.amount); } )
			    .attr("height", barHeight - 1);

			norway_income_bars.append("text")
			    .attr("id", function(d) { return "label_"+d.id; } )
			    .attr("x", function(d) { return x_budget_scale(d.amount) + 10; } )
			    .attr("y", barHeight / 2)
			    .attr("dy", ".35em")
			    .text(function(d) { return d.name + ' (' + moneyFormat.to(d.amount) + ')'; });


      // Norway expenses chart

      var norway_expenses_chart = d3.select("#norway_expenses")
					//.attr("width", width)
					//.attr("height", barHeight * norsk_statsbudsjett_2017_utgifter.length);
          .classed("svg-container", true)
          .attr("preserveAspectRatio", "xMinYMin meet")
          .attr("viewBox", "0 0 600 400");


			var norway_expenses_bars = norway_expenses_chart.selectAll("g")
			    .data(norsk_statsbudsjett_2017_utgifter.sort(function(a,b) { return b.sum - a.sum; }), function(d){ global_norway_total_expenses += d.sum;  })
			  .enter().append("g")
			    .attr("transform", function(d, i) { return "translate(0," + i * barHeight + ")"; });

      global_norway_expenses_bars = norway_expenses_bars;

			var x_expense_scale = d3.scaleLinear()
					.domain([0,d3.max(norsk_statsbudsjett_2017_utgifter, function(d) { return d.sum; })])
					.range([0, width - 700]);

			norway_expenses_bars.append("rect")
			    .attr("id", function(d) { return "bar_"+d.id; } )
          .attr("x", 400)
			    .attr("width", function(d) { return x_expense_scale(d.sum); } )
			    .attr("height", barHeight - 1);

			norway_expenses_bars.append("text")
			    .attr("id", function(d) { return "label_"+d.id; } )
          .attr("x", 10 )
			    // .attr("x", function(d) { return x_expense_scale(d.sum) + 10; } )
			    .attr("y", barHeight / 2)
			    .attr("dy", ".15em")
			    .text(function(d) { return d.name +
																			' (' +
																			moneyFormat.to(d.sum) +
																			')';
														});

      // Initial update
      update(personinntekt);

    });



	// Tax details chart
	var tax_details = d3.select("#tax_details")
	    .attr("width", width)
	    .attr("height", height);

	var tax_details_bar = tax_details.selectAll("g")
	    .data(tax_detail_data)
	  .enter().append("g")
	    .attr("transform", function(d, i) { return "translate(0," + i * barHeight + ")"; });

	tax_details_bar.append("rect")
	    .attr("id", function(d) { return "bar_"+d.id; } )
	    .attr("width", function(d) { return x_salary_scale(d.amount); } )
	    .attr("height", barHeight - 1);

	tax_details_bar.append("text")
	    .attr("id", function(d) { return "label_"+d.id; } )
	    .attr("x", "120" )
	    .attr("y", barHeight / 2)
	    .attr("dy", ".35em")
	    .text(function(d) { return d.name; });

	tax_details.append("g")
	    .attr("class", "x axis")
	    .attr("transform", "translate(0," + height + ")")
	    .call(xAxis);

  var quiz_q1_value;
  function quiz_q1_update(amount){
    // Update user guess indicator
    document.getElementById("quiz_q2_value_field").innerHTML = "Statsbudsjett: " + moneyFormat.to(+amount);
    // Update global variable
    quiz_q1_value = +amount;
  }

  var quiz_q2_value;
  function quiz_q2_update(amount){
    // Update user guess indicator
    document.getElementById("quiz_q2_value_field").innerHTML = "Uttak fra oljefondet: " + pct_format.to((amount/global_norway_total_expenses) * 100) + " (" + moneyFormat.to(+amount) +")";
    // Update global variable
    quiz_q2_value = +amount;
  }

  var quiz_q3_value;
  function quiz_q3_update(amount){
    // Update user guess indicator
    document.getElementById("quiz_q3_value_field").innerHTML = "Personskatt som andel av inntekt: " + pct_format.to(+amount);
    // Update global variable
    quiz_q3_value = +amount;
  }

  var quiz_q4_value;
  function quiz_q4_update(amount){
    // Update user guess indicator
    document.getElementById("quiz_q4_value_field").innerHTML = "Meh: " + moneyFormat.to(+amount);
    // Update global variable
    quiz_q4_value = +amount;
  }

  var quiz_q5_value;
  function quiz_q5_update(amount){
    // Update user guess indicator
    document.getElementById("quiz_q5_value_field").innerHTML = "Meh: " + moneyFormat.to(+amount);
    // Update global variable
    quiz_q5_value = +amount;
  }

  var quiz_q6_value;
  function quiz_q6_update(amount){
    // Update user guess indicator
    document.getElementById("quiz_q6_value_field").innerHTML = "Meh: " + moneyFormat.to(+amount);
    // Update global variable
    quiz_q6_value = +amount;
  }

  var quiz_q7_value;
  function quiz_q7_update(amount){
    // Update user guess indicator
    document.getElementById("quiz_q7_value_field").innerHTML = "Meh: " + moneyFormat.to(+amount);
    // Update global variable
    quiz_q7_value = +amount;
  }

  var quiz_q8_value;
  function quiz_q8_update(amount){
    // Update user guess indicator
    document.getElementById("quiz_q8_value_field").innerHTML = "Meh: " + moneyFormat.to(+amount);
    // Update global variable
    quiz_q3_value = +amount;
  }

  var quiz_q9_value;
  function quiz_q9_update(amount){
    // Update user guess indicator
    document.getElementById("quiz_q9_value_field").innerHTML = "Meh: " + moneyFormat.to(+amount);
    // Update global variable
    quiz_q9_value = +amount;
  }




  function check_answer(answer, correct, feedback_id){
      factor = answer / correct;
      if(factor > 1){
          pct = factor * 100 - 100;
          document.getElementById(feedback_id).innerHTML = "Ditt svar er " + pct_format.to(pct) + " høyere enn riktig svar som er " + moneyFormat.to(correct);
      }
      if(factor == 1){
          document.getElementById(feedback_id).innerHTML = "Riktig svar!";
      }
      if(factor < 1){
          pct = (1 - factor) * 100;
          document.getElementById(feedback_id).innerHTML = "Ditt svar er " + pct_format.to(pct) + " lavere enn riktig svar som er " + moneyFormat.to(correct);
      }
  }

	function update(amount){

    // Calculate users tax part of norways income
  	your_part_of_norway_income_ppm = (total_skatt(amount, amount) / global_norway_total_income) * 1000;

    // Update user tax permille
		document.getElementById("your_part_of_norway_income_div").innerHTML = "Din skatt som andel av Norges samlede inntekter i promille: "
																								+ small_ppm_format.to(your_part_of_norway_income_ppm);

    // Update user salary view
    document.getElementById("salary").innerHTML = "Årslønn før skatt: " + moneyFormat.to(+amount);

    // Update text on expense bars
    var expense_bars = global_norway_expenses_bars
      .data(global_norsk_statsbudsjett_2017_inntekter);

    expense_bars.selectAll("text")
      .text(function(d){
            return moneyFormat.to( (d.sum * ( your_part_of_norway_income_ppm / 1000)) / 12 ) + ' av totalt ' + moneyFormat.to(d.sum / 12) + ' til ' + d.name;
          });

		total_tax.selectAll("#bar_total_skatt")
				.attr("width", x_salary_scale(total_skatt(amount, amount)) );
		total_tax.selectAll("#label_total_skatt")
			.text('Total skatt: ' + moneyFormat.to(total_skatt(amount, amount)) + ' (' + total_skatt_pct(amount,amount) + '%)')
			.attr("x", x_salary_scale(total_skatt(amount, amount)) + 10);

		tax_details.selectAll("#bar_total_skatt")
				.attr("width", x_salary_scale(total_skatt(amount, amount)) );
		tax_details.selectAll("#label_total_skatt")
			.text('Total skatt: ' + moneyFormat.to(total_skatt(amount, amount)) + ' (' + total_skatt_pct(amount,amount) + '%)')
			.attr("x", x_salary_scale(total_skatt(amount, amount)) + 10);

	  tax_details.selectAll("#bar_trygdeavgift")
	      .attr("width", x_salary_scale(trygdeavgift(amount)) );
	  tax_details.selectAll("#label_trygdeavgift")
	    .text('Trygdeavgift: ' + moneyFormat.to(trygdeavgift(amount)))
			.attr("x", x_salary_scale(trygdeavgift(amount)) + 10);

	  tax_details.selectAll("#bar_personskatt_stat")
	      .attr("width", x_salary_scale(personskatt_stat(amount)) );
	  tax_details.selectAll("#label_personskatt_stat")
	    .text('Personskatt Staten: ' + moneyFormat.to(personskatt_stat(amount)))
			.attr("x", x_salary_scale(personskatt_stat(amount)) + 10);

		tax_details.selectAll("#bar_personskatt_fylke")
	      .attr("width", x_salary_scale(personskatt_fylke(amount)) );
	  tax_details.selectAll("#label_personskatt_fylke")
	    .text('Personskatt Fylke: ' + moneyFormat.to(personskatt_fylke(amount)))
			.attr("x", x_salary_scale(personskatt_fylke(amount)) + 10);

		tax_details.selectAll("#bar_personskatt_kommune")
				.attr("width", x_salary_scale(personskatt_kommune(amount)) );
		tax_details.selectAll("#label_personskatt_kommune")
			.text('Personskatt Kommune: ' + moneyFormat.to(personskatt_kommune(amount)))
			.attr("x", x_salary_scale(personskatt_kommune(amount)) + 10);

	  tax_details.selectAll("#bar_personskatt_trinn1")
	      .attr("width", x_salary_scale(personskatt_trinn1(amount)) );
	  tax_details.selectAll("#label_personskatt_trinn1")
	    .text('Personskatt trinn 1: ' + moneyFormat.to(personskatt_trinn1(amount)))
			.attr("x", x_salary_scale(personskatt_trinn1(amount)) + 10);

	  tax_details.selectAll("#bar_personskatt_trinn2")
	      .attr("width", x_salary_scale(personskatt_trinn2(amount)) );
	  tax_details.selectAll("#label_personskatt_trinn2")
	    .text('Personskatt trinn 2: ' + moneyFormat.to(personskatt_trinn2(amount)))
			.attr("x", x_salary_scale(personskatt_trinn2(amount)) + 10);

	  tax_details.selectAll("#bar_personskatt_trinn3")
	      .attr("width", x_salary_scale(personskatt_trinn3(amount)) );
	  tax_details.selectAll("#label_personskatt_trinn3")
	    .text('Personskatt trinn 3: ' + moneyFormat.to(personskatt_trinn3(amount)))
			.attr("x", x_salary_scale(personskatt_trinn3(amount)) + 10);

	  tax_details.selectAll("#bar_personskatt_trinn4")
	      .attr("width", x_salary_scale(personskatt_trinn4(amount)) );
	  tax_details.selectAll("#label_personskatt_trinn4")
	    .text('Personskatt trinn 4: ' + moneyFormat.to(personskatt_trinn4(amount)))
			.attr("x", x_salary_scale(personskatt_trinn4(amount)) + 10);

		x_salary_scale.domain([0, amount])
		    	.range([0, width]);

	}

  // Quiz question 1
  var quiz_q1_slider = document.getElementById('quiz_q1_slider');
	noUiSlider.create(quiz_q1_slider, {
	              start: [ 0 ],
	              step: 1000000,
	              range: {
	                'min': [          0 ],
                  '50%': [   100000000000, 100000000 ],
                  '70%': [  1000000000000, 10000000 ],
	                'max': [ 10000000000000 ]
	              },
                pips: {
                  mode: 'values',
              		values: [0, 50000000000, 1000000000000],
                  density: 3,
                  format: moneyFormat
                }
	            });

	quiz_q1_slider.noUiSlider.on('update', function( value, handle ) {
	    quiz_q1_update(value);
	});

  // Quiz question 2
  var quiz_q2_slider = document.getElementById('quiz_q2_slider');
	noUiSlider.create(quiz_q2_slider, {
	              start: [ 0 ],
	              step: 1000000,
	              range: {
	                'min': [             0 ],
	                'max': [ 1611494577000 ]
	              },
                pips: {
                  mode: 'values',
              		values: [0, 500000000000, 1000000000000],
                  density: 3,
                  format: moneyFormat
                }
	            });

	quiz_q2_slider.noUiSlider.on('update', function( value, handle ) {
	    quiz_q2_update(value);
	});

  // Quiz question 3
  var quiz_q3_slider = document.getElementById('quiz_q3_slider');
	noUiSlider.create(quiz_q3_slider, {
	              start: [ 0 ],
	              step: 1,
	              range: {
	                'min': [   0 ],
	                'max': [ 100 ]
	              },
                pips: {
                  mode: 'values',
              		values: [0, 50, 100],
                  density: 3,
                  format: pct_format
                }
	            });

	quiz_q3_slider.noUiSlider.on('update', function( value, handle ) {
	    quiz_q3_update(value);
	});

  // Quiz question 4
  var quiz_q4_slider = document.getElementById('quiz_q4_slider');
	noUiSlider.create(quiz_q4_slider, {
	              start: [ 0 ],
	              step: 1,
	              range: {
	                'min': [   0 ],
	                'max': [ 100 ]
	              },
                pips: {
                  mode: 'values',
              		values: [0, 50, 100],
                  density: 3
                }
	            });

	quiz_q4_slider.noUiSlider.on('update', function( value, handle ) {
	    quiz_q4_update(value);
	});

  // Quiz question 5
  var quiz_q5_slider = document.getElementById('quiz_q5_slider');
	noUiSlider.create(quiz_q5_slider, {
	              start: [ 0 ],
	              step: 1,
	              range: {
	                'min': [   0 ],
	                'max': [ 100 ]
	              },
                pips: {
                  mode: 'values',
              		values: [0, 50, 100],
                  density: 3
                }
	            });

	quiz_q5_slider.noUiSlider.on('update', function( value, handle ) {
	    quiz_q5_update(value);
	});

  // Quiz question 6
  var quiz_q6_slider = document.getElementById('quiz_q6_slider');
	noUiSlider.create(quiz_q6_slider, {
	              start: [ 0 ],
	              step: 1,
	              range: {
	                'min': [   0 ],
	                'max': [ 100 ]
	              },
                pips: {
                  mode: 'values',
              		values: [0, 50, 100],
                  density: 3
                }
	            });

	quiz_q6_slider.noUiSlider.on('update', function( value, handle ) {
	    quiz_q6_update(value);
	});

  // Quiz question 7
  var quiz_q7_slider = document.getElementById('quiz_q7_slider');
	noUiSlider.create(quiz_q7_slider, {
	              start: [ 0 ],
	              step: 1,
	              range: {
	                'min': [   0 ],
	                'max': [ 100 ]
	              },
                pips: {
                  mode: 'values',
              		values: [0, 50, 100],
                  density: 3
                }
	            });

	quiz_q7_slider.noUiSlider.on('update', function( value, handle ) {
	    quiz_q7_update(value);
	});

  // Quiz question 8
  var quiz_q8_slider = document.getElementById('quiz_q8_slider');
	noUiSlider.create(quiz_q8_slider, {
	              start: [ 0 ],
	              step: 1,
	              range: {
	                'min': [   0 ],
	                'max': [ 100 ]
	              },
                pips: {
                  mode: 'values',
              		values: [0, 50, 100],
                  density: 3
                }
	            });

	quiz_q8_slider.noUiSlider.on('update', function( value, handle ) {
	    quiz_q8_update(value);
	});

  // Quiz question 9
  var quiz_q9_slider = document.getElementById('quiz_q9_slider');
	noUiSlider.create(quiz_q9_slider, {
	              start: [ 0 ],
	              step: 1,
	              range: {
	                'min': [   0 ],
	                'max': [ 100 ]
	              },
                pips: {
                  mode: 'values',
              		values: [0, 50, 100],
                  density: 3
                }
	            });

	quiz_q9_slider.noUiSlider.on('update', function( value, handle ) {
	    quiz_q9_update(value);
	});




  // Salary slider on top
	var salary_slider = document.getElementById('salary_slider');

	noUiSlider.create(salary_slider, {
	              start: [ 528000 ],
	              step: 10000,
	              range: {
	                'min': [        0 ],
                  '20%': [   200000, 10000 ],
                  '50%': [  1000000, 20000 ],
                  '70%': [  5000000, 50000 ],
	                'max': [ 11000000 ]
	              },
                pips: {
                  mode: 'values',
              		values: [0, 100000, 500000, 1000000, 5000000, 9000000],
                  density: 3,
                  format: moneyFormat
                }
	            });

	salary_slider.noUiSlider.on('update', function( value, handle ) {
	  update(value);

	});



	</script>


</html>
